---
title: "BEA_build"
author: "Britta Schumacher"
date: "Last updated: `r format(Sys.time(), '%d %B, %Y')`"
output: 
  html_document:
    theme: yeti
    toc: yes
    toc_float: true
    code_folding: hide
---

```{r warning = FALSE, message = FALSE}
#source("BEA_load.R")
source("./func/BEA_func.R")
library(tidyverse)
library(sp)
#file_list <- Sys.glob("./data/*ALL_AREAS*.csv")
#file_list

ctys <- readRDS("./data/county.RDS")
```

# Farm income and expenses

```{r warning = FALSE, message = FALSE}
income_expenses <- clean_BEA("./data/CAINC45__ALL_AREAS_1969_2019.csv") # farm income and expenses
unique(income_expenses$Description)

income_expenses <- income_expenses %>% filter(Description != "") %>% select(GEOID, YEAR, GeoName, Region, Description, value) %>% filter(Description != "") %>% pivot_wider(names_from = Description, values_from = value)

income_expenses <- income_expenses[c(1:23,25,27:33)]
colnames(income_expenses) <- c("GEOID", "YEAR", "GeoName", "Region", "mark_receipts", "liv_receipts", "crops_receipts","oth_income","gov_pay","misc_income","prod_exp","feed","livestock","seeds","fert_lime","petrol","hired_labor","oth_exp","vic","vic_live","vic_crops","vic_mat","cash_income","net_income","net_income_inclcorp","net_income_corp","stat_adj","farmprop_income","wage_sal","supp","farm_earn")

income_expenses <- income_expenses[c(1:27,29:31)]
# mark_receipts == "Cash receipts from marketings (thousands of dollars)"
# liv_receipts == "Cash receipts: Livestock and products"               
# crops_receipts == "Cash receipts: Crops"                                
# oth_income == "Other income"                                        
# gov_pay == "Government payments"                                 
# misc_income == "Imputed and miscellaneous income received 1/"        
# prod_exp == "Production expenses"                                 
# feed ==  "Feed purchased"                                      
# livestock == "Livestock purchased"                                 
# seeds == "Seed purchased"  
# fert_lime == "Fertilizer and lime (incl. ag. chemicals 1978-fwd.)" 
# petrol == "Petroleum products purchased"                        
# hired_labor == "Hired farm labor expenses 2/"                        
# oth_exp == "All other production expenses 3/"                    
# vic == "Value of inventory change"                           
# vic_live == "Value of inventory change: livestock"                
# vic_crops == "Value of inventory change: crops"                    
# vic_ mat == "Value of inventory change: materials and supplies"   
# cash_income == "Cash receipts and other income"                      
# net_income == "Equals: Realized net income" (Cash receipts and other income-Production expenses)       
# net_income_inclcorp == "Equals: Net income including corporate farms"  (Realized net income + Value of inventory change)      
## net_income_corp == "Less: Net income of corporate farms"                 
## stat_adj == "Plus: Statistical adjustment"                        
# farmprop_income == "Equals: Farm proprietors' income" (Net income including corporate farms - Net income of corporate farms + Statistical adjustment)                   
## wage_sal == "Plus: Farm wages and salaries"                       
## supp == "Plus: Farm supplements to wages and salaries"        
# farm_earn == "Equals: Farm earnings" (Farm proprietors' income + Farm wages and salaries + Farm supplements to wages and salaries)
```

# GDP

## Contributions to percent change in real GDP by county & MSA

Here I select for just "Agriculture, forestry, fishing and hunting", so we are only capturing changes in county GDP based on this NAICS sector.
```{r warning = FALSE, message = FALSE}
perc_change_GDP <- clean_BEA("./data/CAGDP11__ALL_AREAS_2002_2019.csv") # contributions to percent change in real GDP by county & MSA
# unique(perc_change_GDP$Description)

perc_change_GDP_ag <- perc_change_GDP %>% filter(Description == "Agriculture, forestry, fishing and hunting")

perc_change_GDP_ag <- perc_change_GDP_ag[c(1,2,8:10)]
perc_change_GDP_ag <- perc_change_GDP_ag %>% select(GEOID, YEAR, GeoName, Region, value)
colnames(perc_change_GDP_ag)[5] <- "perc_change_GDP_ag"

# perc_change_GDP == percent change in real GDP by county & MSA
```

## GDP summary by county and MSA 

```{r warning = FALSE, message = FALSE}
summary_GDP <- clean_BEA("./data/CAGDP1__ALL_AREAS_2001_2019.csv") # GDP summary by county and MSA
#unique(summary_GDP$Description)

summary_GDP_ag <- summary_GDP[c(1,2,6,8:10)]
summary_GDP_ag <- summary_GDP_ag %>% select(GEOID, YEAR, GeoName, Region, Description, value) %>% filter(Description != "") %>% pivot_wider(names_from = Description, values_from = value)

colnames(summary_GDP_ag) <- c("GEOID", "YEAR", "GeoName", "Region", "real_GDP", "CTQI_real_GDP", "current_GDP")
# where
# real_GDP == Real GDP (in thousands of chained 2012 dollars)
# CTQI_real_GDP == Chain-type quantity indexes for real GDP (quantity index)
# current_GDP == Current-dollar GDP (in thousands of current dollars)
```

## GDP in current dollars by county and MSA

Here I select for just "Agriculture, forestry, fishing and hunting", so we are only capturing county GDP based on this NAICS sector. GDP is measured in thousands of dollars.
```{r warning = FALSE, message = FALSE}
current_GDP <- clean_BEA("./data/CAGDP2__ALL_AREAS_2001_2019.csv") # GDP in current dollars by county and MSA
#unique(current_GDP$Description)
current_GDP$GEOID <- as.factor(sapply(current_GDP$GEOID, function(x) gsub("\"", "", x)))

current_GDP_ag <- current_GDP %>% filter(Description == "Agriculture, forestry, fishing and hunting") 

current_GDP_ag <- current_GDP_ag[c(1,2,8:10)]
current_GDP_ag <- current_GDP_ag %>% select(GEOID, YEAR, GeoName, Region, value)
colnames(current_GDP_ag)[5] <- "current_GDP_ag"

# where,
# current_GDP_ag == GDP in current dollars (in thousands of dollars) for Ag, forestry, fishing and hunting
```

## Chain-type quantity indexes for real GDP by county and MSA

Here I select for just "Agriculture, forestry, fishing and hunting", so we are only capturing county GDP based on this NAICS sector. GDP chain index base year is 2012.
```{r warning = FALSE, message = FALSE}
real_GDP <- clean_BEA("./data/CAGDP8__ALL_AREAS_2001_2019.csv") # chain-type quantity indxes for real GDP by county and MSA
unique(real_GDP$Description)

real_GDP_ag <- real_GDP %>% filter(Description == "Agriculture, forestry, fishing and hunting")
real_GDP_ag <- real_GDP_ag[c(1,2,8:10)]
real_GDP_ag <- real_GDP_ag %>% select(GEOID, YEAR, GeoName, Region, value)
colnames(real_GDP_ag)[5] <- "CTQI_real_GDP_ag"

# where,
# chainindex_GDP_ag == Quantity index for real GDP in Ag, forestry, ishing and hunting
```

## Real GDP in chained dollars by county and MSA

Here I select for just "Agriculture, forestry, fishing and hunting", so we are only capturing county GDP based on this NAICS sector. GDP is measured in thousands of chained 2012 dollars.

```{r warning = FALSE, message = FALSE}
chained_GDP <- clean_BEA("./data/CAGDP9__ALL_AREAS_2001_2019.csv") # Real GDP in chained dollars by county and MSA
#unique(chained_GDP$Description)

chained_GDP_ag <- chained_GDP %>% filter(Description == "Agriculture, forestry, fishing and hunting")
chained_GDP_ag <- chained_GDP_ag[c(1,2,8:10)]
chained_GDP_ag <- chained_GDP_ag %>% select(GEOID, YEAR, GeoName, Region, value)
colnames(chained_GDP_ag)[5] <- "real_GDP_ag"

# where,
# chained2012dollars_ag == Thousands of chained 2012 dollars
```

Chain-type quantity indexes for real GDP: A quantity index is an index number that measures the change in the level of a quantity from a base year, apart from any changes in relative prices. The value of the quantity index is 100 for the base year. BEA uses chain-type annual-weighted indexes, also known as Fisher indexes, as its measure of real output and prices. These measures allow for the effects of changes in relative prices and in the composition of output over time, thereby eliminating a major source of bias inherent in fixed-weight indexes.

### Merge all GDP data.frames
```{r warning = FALSE, message = FALSE}
GDP <- Reduce(function(x,y) merge(x,y,by=c("GEOID","YEAR","GeoName","Region"),all=TRUE) ,list(summary_GDP_ag,perc_change_GDP_ag,current_GDP_ag,real_GDP_ag,chained_GDP_ag))
```

# Employment

## Total full-time and part-time employment by NAICS Industry

**Total employment**: A count of jobs, both full-time and part-time. It includes wage and salary jobs, sole proprietorships, and individual general partners, but not unpaid family workers nor volunteers.
**Proprietors employment**: Consists of farm proprietors employment and nonfarm proprietors employment.
**Farm proprietors employment**: Consists of sole proprietors and non-corporate partners in the farm industry.
**Farm employment**: The number of workers engaged in the direct production of agricultural commodities, either livestock or crops; whether as a sole proprietor, partner, or hired laborer.

```{r warning = FALSE, message = FALSE}
employment_NAICS <- clean_BEA("./data/CAEMP25N__ALL_AREAS_2001_2019.csv") # total full-time and part-time employment by NAICS Industry
#unique(employment_NAICS$Description)
#unique(employment_NAICS$IndustryClassification)

employment_NAICS_farm <- employment_NAICS %>% filter(Description %in% c("Total employment (number of jobs)", "Proprietors employment", "Farm proprietors employment", "Farm employment")) %>% mutate_each(funs(str_replace_all(., "\"", ""))) %>% select(GEOID, YEAR, GeoName, Region, Description, value) %>% filter(Description != "") %>% pivot_wider(names_from = Description, values_from = value)

colnames(employment_NAICS_farm) <- c("GEOID", "YEAR", "GeoName", "Region", "totjobs_NAICS", "prop_NAICS", "farmprop_NAICS","farmempl_NAICS")
# where
# totjobs_NAICS == Total employment (number of jobs)
# prop_NAICS == Proprietors employment (number of jobs)
# farmprop_NAICS == Farm proprietors employment (number of jobs)
# farmempl_NAICS == farm employment (number of jobs)
```

## Total full-time and part-time employment by SIC Industry

```{r warning = FALSE, message = FALSE}
employment_SIC <- clean_BEA("./data/CAEMP25S__ALL_AREAS_1969_2000.csv") # total full-time and part-time employment by SIC Industry
unique(employment_SIC$Description)

employment_SIC_farm <- employment_SIC %>% filter(Description %in% c("Total employment (number of jobs)", "Proprietors employment", "Farm proprietors employment", "Farm employment")) %>% select(GEOID, YEAR, GeoName, Region, Description, value) %>% filter(Description != "") %>% pivot_wider(names_from = Description, values_from = value)

colnames(employment_SIC_farm) <- c("GEOID", "YEAR", "GeoName", "Region", "totjobs_SIC", "prop_SIC", "farmprop_SIC","farmempl_SIC")
# where
# totjobs_SIC == Total employment (number of jobs)
# prop_SIC == Proprietors employment (number of jobs)
# farmprop_SIC == Farm proprietors employment (number of jobs)
# farmempl_SIC == farm employment (number of jobs)
```

### Merge all employment data.frames
```{r warning = FALSE, message = FALSE}
employment <- Reduce(function(x,y) merge(x,y,by=c("GEOID","YEAR","GeoName","Region"),all=TRUE) ,list(employment_SIC_farm, employment_NAICS_farm))

employment <- employment %>% select("GEOID","YEAR","GeoName","Region","totjobs_SIC","totjobs_NAICS","prop_SIC","prop_NAICS","farmprop_SIC","farmprop_NAICS","farmempl_SIC","farmempl_NAICS")
```

# Income and earnings

## Annual personal income by county

```{r warning = FALSE, message = FALSE}
pers_income <- clean_BEA("./data/CAINC1__ALL_AREAS_1969_2019.csv") # Annual personal income by county
unique(pers_income$Description)
pers_income <- pers_income[c(1,2,6:10)]
pers_income$Description <- as.factor(pers_income$Description)
pers_income_piv <- pers_income %>% select(GEOID, YEAR, GeoName, Region, Description, value) %>% filter(Description != "") %>% pivot_wider(names_from = Description, values_from = value)

colnames(pers_income_piv) <- c("GEOID", "YEAR", "GeoName", "Region", "pers_income", "pop", "percap_income")
# where
# pers_income == Personal income (thousands of dollars)
# pop == Population (persons)
# percap_income == Per capita personal income (dollars)
```

# Economic profile by county

**Farm proprietors' income**: Farm proprietors' income consists of the income that is received by the sole proprietorships and the partnerships that operate farms. It excludes the income that is received by corporate farms.
**Farm proprietors employment**: Consists of sole proprietors and non-corporate partners in the farm industry.
**Nonfarm proprietors' income**: Nonfarm Proprietors' Income consists of the income that is received by nonfarm sole proprietorships and partnerships and the income that is received by tax-exempt cooperatives.
The national estimates of nonfarm proprietors' income are primarily derived from income tax data. Because these data do not always reflect current production and because they are incomplete, the estimates also include four major adjustments--the inventory valuation adjustment, the capital consumption adjustment, the "misreporting" adjustment, and the adjustment for the net margins on owner-built housing.
The inventory valuation adjustment offsets the effects of the gains and the losses that result from changes in the prices of products withdrawn from inventories; this adjustment for recent years has been small, but it is important to the definition of proprietors' income.
The capital consumption adjustment changes the value of the consumption, or depreciation, of fixed capital from the historical-cost basis used in the source data to a replacement-cost basis.
The "misreporting" adjustment adds an estimate of the income of sole proprietors and partnerships that is not reported on tax returns.
The adjustment for the net margins on owner-built housing is an addition to the estimate for the construction industry. It is the imputed net income of individuals from the construction or renovation of their own dwellings.
The source data necessary to prepare these adjustments are available only at the national level. Therefore, the national estimates of nonfarm proprietors' income that include the adjustments are allocated to states, and these state estimates are allocated to the counties, in proportion to tax return data that do not reflect the adjustments.
In addition, the national estimates include adjustments made to reflect decreases in monetary and imputed income that result from damage to fixed capital and to inventories that is caused by disasters, such as hurricanes, floods, and earthquakes. These adjustments are attributed to states and counties on the basis of information from the Federal Emergency Management Agency.
**Nonfarm proprietors employment**: Consists of the number of nonfarm sole proprietorships and the number of individual general partners in nonfarm partnerships.

```{r warning = FALSE, message = FALSE}
econ_profile <- clean_BEA("./data/CAINC30__ALL_AREAS_1969_2019.csv") # economic profile by county
unique(econ_profile$Description)
econ_profile$Description <- as.factor(econ_profile$Description)

econ_profile_farm <- econ_profile %>% filter(Description %in% c("Farm proprietors' income", "Farm proprietors employment 6/", "Nonfarm proprietors' income", "Nonfarm proprietors employment")) %>% select(GEOID, YEAR, GeoName, Region, Description, value) %>% filter(Description != "") %>% pivot_wider(names_from = Description, values_from = value)

colnames(econ_profile_farm) <- c("GEOID", "YEAR", "GeoName", "Region", "farmprop_income", "nonfarmprop_income", "farmprop_employ","nonfarmprop_employ")

# where,
# farmprop_income == Farm proprietors' income (thousands of dollars)
# farmprop_employ == Farm proprietors employment (number of jobs)
# nonfarmprop_income == Nonfarm Proprietors' Income (thousands of dollars)
# nonfarmprop_employ == Nonfarm proprietors employment (number of jobs)
```

# Personal income and employment by major component by county

**Personal income**: Consists of the income that persons receive in return for their provision of labor, land, and capital used in current production as well as other income, such as personal current transfer receipts. In the state and local personal income accounts the personal income of an area represents the income received by or on behalf of the persons residing in that area. It is calculated as the sum of wages and salaries, supplements to wages and salaries, proprietors' income with inventory valuation (IVA) and capital consumption adjustments (CCAdj), rental income of persons with capital consumption adjustment (CCAdj), personal dividend income, personal interest income, and personal current transfer receipts, less contributions for government social insurance plus the adjustment for residence.
**Farm income**: Consists of wages and salaries, employer contributions for employee pension and insurance funds, and proprietors' income in the farm industry (NAICS subsectors 111-Crop Production and 112-Animal Production). Farm personal income comprises the net personal income of sole proprietors, partners, and hired laborers arising directly from the current production of agricultural commodities, both livestock and crops. It excludes corporate farm income.
**Farm propriators' income**: Farm proprietors' income consists of the income that is received by the sole proprietorships and the partnerships that operate farms. It excludes the income that is received by corporate farms.
```{r warning = FALSE, message = FALSE}
inc_employ_mc <- clean_BEA("./data/CAINC4__ALL_AREAS_1969_2019.csv") # personal income and employment by major component by county
unique(inc_employ_mc$Description)

inc_employ_mc_farm <- inc_employ_mc %>% filter(Description %in% c("Personal income (thousands of dollars)", "Farm income 2/", "Farm proprietors' income")) %>% select(GEOID, YEAR, GeoName, Region, Description, value) %>% filter(Description != "") %>% pivot_wider(names_from = Description, values_from = value)

colnames(inc_employ_mc_farm) <- c("GEOID", "YEAR", "GeoName", "Region", "pers_income", "farm_income", "farmprop_income")

# where,
# pers_income == Personal income (in thousands of dollars)
# farm_income == Farm income (in thousands of dollars)
# farmprop_income == Farm proprietors' income (in thousands of dollars)
```

# Personal income by major component and earnings by NAICS Industry

**Farm earnings**: incorrect definition!!
**Nonfarm earnings**: Nonfarm Earnings is the sum of wages and salaries, supplements to wages and salaries, and proprietors' income for all industries, excluding farm.
```{r warning = FALSE, message = FALSE}
earn_naics <- clean_BEA("./data/CAINC5N__ALL_AREAS_2001_2019.csv") # personal income by major component and earnings by NAICS Industry
#unique(earn_naics$Description)

earn_naics_farm <- earn_naics %>% filter(Description %in% c("Farm earnings", "Nonfarm earnings")) %>% select(GEOID, YEAR, GeoName, Region, Description, value) %>% filter(Description != "") %>% pivot_wider(names_from = Description, values_from = value)
                                                        
colnames(earn_naics_farm) <- c("GEOID", "YEAR", "GeoName", "Region", "farm_earn_naics", "nonfarm_earn_naics")
# where,
# farm_earn == Farm earnings (in thousands of dollars)
# nonfarm_earn == Nonfarm earnings (in thousands of dollars)
```

# Personal income by major component and earnings by SIC Industry

```{r warning = FALSE, message = FALSE}
earn_sic <- clean_BEA("./data/CAINC5S__ALL_AREAS_1969_2000.csv") # personal income by major component and earnings by SIC Industry
unique(earn_sic$Description)

earn_sic_farm <- earn_sic %>% filter(Description %in% c("Farm earnings", "Nonfarm earnings", "Agricultural services")) %>% select(GEOID, YEAR, GeoName, Region, Description, value) %>% filter(Description != "") %>% pivot_wider(names_from = Description, values_from = value)

colnames(earn_sic_farm) <- c("GEOID", "YEAR", "GeoName", "Region", "farm_earn_sic", "nonfarm_earn_sic","agserv_earn_sic")
# where,
# farm_earn_sic == Farm earnings (in thousands of dollars)
# nonfarm_earn_sic == Nonfarm earnings (in thousands of dollars)
# agserv_earn_sic == 
```

## Personal current transfer receipts

SNAP benefits are in thousands of dollars. 

Supplemental Nutrition Assistance Program (SNAP): These benefits, under the Supplemental Nutritional Assistance Program (SNAP) (formerly called food stamps), are issued to qualifying low-income individuals in order to supplement their ability to purchase food. Eligibility is determined by each state's interpretation of federal regulations; the U.S. Department of Agriculture (USDA) pays the cost of the benefits. The state estimates are based on tabulations of the value of the distributed benefits from the Department of Agriculture. The state estimates are allocated to counties based on payments data from the various state departments of social services. When payment data are not available, data on the number of SNAP recipients from Census Bureau's Small Area Income and Poverty Estimates program are used to extrapolate or interpolate.

```{r warning = FALSE, message = FALSE}
trans_rec <- clean_BEA("./data/CAINC35__ALL_AREAS_1969_2019.csv") # personal current transfer receipts
#unique(trans_rec$Description)

trans_rec_snap <- trans_rec %>% filter(Description == "Supplemental Nutrition Assistance Program (SNAP)")
trans_rec_snap <- trans_rec_snap[c(1,2,8:10)]
colnames(trans_rec_snap)[5] <- "snap"

# where,
# snap == SNAP benefits (in thousands of dollars)
```

### Merge all income data.frames
```{r warning = FALSE, message = FALSE}
income <- Reduce(function(x,y) merge(x,y,by=c("GEOID","YEAR","GeoName","Region"),all=TRUE) ,list(pers_income_piv,econ_profile_farm,inc_employ_mc_farm,earn_naics_farm,earn_sic_farm,trans_rec_snap))

income <- income[c(1:11,13,15:20)]
colnames(income)[5] <- "pers_income"
colnames(income)[8] <- "farmprop_income"

income <- income %>% select("GEOID","YEAR","GeoName","Region","farmprop_employ","nonfarmprop_employ","pers_income","pop","percap_income","farm_income","farmprop_income","nonfarmprop_income","farm_earn_sic","farm_earn_naics","nonfarm_earn_sic","nonfarm_earn_naics","agserv_earn_sic","snap")
```

# Compensation of employees

## Compensation of employees by NAICS Industry

```{r warning = FALSE, message = FALSE}
comp_naics <- clean_BEA("./data/CAINC6N__ALL_AREAS_2001_2019.csv") # compensation of employees by NAICS Industry
unique(comp_naics$Description)

comp_naics_farm <- comp_naics %>% filter(Description %in% c("Compensation of employees (thousands of dollars) 1/", "Farm compensation")) %>% select(GEOID, YEAR, GeoName, Region, Description, value) %>% filter(Description != "") %>% pivot_wider(names_from = Description, values_from = value)

colnames(comp_naics_farm) <- c("GEOID", "YEAR", "GeoName", "Region", "comp_naics", "farm_comp_naics")
# where,
# comp_naics == Compensation of employees (in thousands of dollars)
# farm_comp_naics == farm compensation (in thousands of dollars)
```

## Compensation of employees by SIC Industry

**Agricultural services**: Agricultural Services (SIC) includes establishments primarily engaged in performing soil preparation services, crop services, veterinary services, other animal services, farm labor and management services, and landscape and horticultural services, for others on a contract or fee basis.
```{r warning = FALSE, message = FALSE}
comp_sic <- clean_BEA("./data/CAINC6S__ALL_AREAS_1998_2000.csv") # compensation of employees by SIC Industry
unique(comp_sic$Description)

comp_sic_farm <- comp_sic %>% filter(Description %in% c("Compensation of employees (thousands of dollars) 1/", "Farm compensation", "Agricultural services")) %>% select(GEOID, YEAR, GeoName, Region, Description, value) %>% filter(Description != "") %>% pivot_wider(names_from = Description, values_from = value)

colnames(comp_sic_farm) <- c("GEOID", "YEAR", "GeoName", "Region", "comp_sic", "farm_comp_sic", "agserv_comp_sic")
# where,
# comp_sic == Compensation of employees (in thousands of dollars)
# farm_comp_sic == farm compensation (in thousands of dollars)
# agserv_comp_sic == Agricultural Services (SIC) includes establishments primarily engaged in performing soil preparation services, crop services, veterinary services, other animal services, farm labor and management services, and landscape and horticultural services, for others on a contract or fee basis. (in thousands of dollars)
```

### Merge all compensation data.frames
```{r warning = FALSE, message = FALSE}
compensation <- Reduce(function(x,y) merge(x,y,by=c("GEOID","YEAR","GeoName","Region"),all=TRUE) ,list(comp_sic_farm,comp_naics_farm))

compensation <- compensation %>% select("GEOID","YEAR","GeoName","Region","comp_sic","comp_naics","farm_comp_sic","farm_comp_naics","agserv_comp_sic")
```

# Gross flow of earnings

```{r warning = FALSE, message = FALSE}
gross_earn <- clean_BEA("./data/CAINC91__ALL_AREAS_1990_2019.csv") # gross flow of earnings
unique(gross_earn$Description)

gross_earn <- gross_earn %>% filter(Description %in% c("Inflows of earnings", "Outflows of earnings", "Adjustment for residence")) %>% select(GEOID, YEAR, GeoName, Region, Description, value) %>% filter(Description != "") %>% pivot_wider(names_from = Description, values_from = value)

colnames(gross_earn) <- c("GEOID", "YEAR", "GeoName", "Region", "inflow_earn", "outflow_earn", "resid_adj")

# where,
# inflow_earn == Inflows of earnings (in thousands of dollars)
# outflow_earn == Outflows of earnings (in thousands of dollars)
# resid_adj == Adjustment for residence (in thoousands of dollars)
# NOT ENTIRELY CLEAR ON THESE DEFITIONS!!
```

# Merge all major data.frames & save

```{r}
bea_df <- Reduce(function(x,y) merge(x,y,by=c("GEOID","YEAR","GeoName","Region"),all=TRUE) ,list(income_expenses,GDP,employment,income,compensation,gross_earn))

saveRDS(bea_df, "./data/bea.RDS")
```

